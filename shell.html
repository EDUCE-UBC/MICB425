<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Running TreeSAPP on the Google Cloud Platform | Mapping microbes and marine denitrification</title>
  <meta name="description" content="This is the project information for MICB425 Module 04." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Running TreeSAPP on the Google Cloud Platform | Mapping microbes and marine denitrification" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the project information for MICB425 Module 04." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Running TreeSAPP on the Google Cloud Platform | Mapping microbes and marine denitrification" />
  
  <meta name="twitter:description" content="This is the project information for MICB425 Module 04." />
  

<meta name="author" content="Stephan Koenig, Kim Dill-McFarland, Ryan McLaughlin, Connor Morgan-Lang, Steven Hallam" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="instructions.html"/>
<link rel="next" href="R.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#background"><i class="fa fa-check"></i><b>1.1</b> Background</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#methods"><i class="fa fa-check"></i><b>1.2</b> Methods</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#using-meta-omics-data"><i class="fa fa-check"></i><b>1.3</b> Using meta-omics data</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#treesapp"><i class="fa fa-check"></i><b>1.4</b> TreeSAPP</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="instructions.html"><a href="instructions.html"><i class="fa fa-check"></i><b>2</b> Instructions</a><ul>
<li class="chapter" data-level="2.1" data-path="instructions.html"><a href="instructions.html#timeline"><i class="fa fa-check"></i><b>2.1</b> Timeline</a></li>
<li class="chapter" data-level="2.2" data-path="instructions.html"><a href="instructions.html#reports"><i class="fa fa-check"></i><b>2.2</b> Reports</a><ul>
<li class="chapter" data-level="2.2.1" data-path="instructions.html"><a href="instructions.html#abstract"><i class="fa fa-check"></i><b>2.2.1</b> Abstract</a></li>
<li class="chapter" data-level="2.2.2" data-path="instructions.html"><a href="instructions.html#introduction-1"><i class="fa fa-check"></i><b>2.2.2</b> Introduction</a></li>
<li class="chapter" data-level="2.2.3" data-path="instructions.html"><a href="instructions.html#methods-1"><i class="fa fa-check"></i><b>2.2.3</b> Methods</a></li>
<li class="chapter" data-level="2.2.4" data-path="instructions.html"><a href="instructions.html#research-questions"><i class="fa fa-check"></i><b>2.2.4</b> Results</a></li>
<li class="chapter" data-level="2.2.5" data-path="instructions.html"><a href="instructions.html#discussion"><i class="fa fa-check"></i><b>2.2.5</b> Discussion</a></li>
<li class="chapter" data-level="2.2.6" data-path="instructions.html"><a href="instructions.html#references"><i class="fa fa-check"></i><b>2.2.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="instructions.html"><a href="instructions.html#assessment"><i class="fa fa-check"></i><b>2.3</b> Assessment</a><ul>
<li class="chapter" data-level="2.3.1" data-path="instructions.html"><a href="instructions.html#peer-evaluation-5"><i class="fa fa-check"></i><b>2.3.1</b> Peer evaluation (5%)</a></li>
<li class="chapter" data-level="2.3.2" data-path="instructions.html"><a href="instructions.html#report-10"><i class="fa fa-check"></i><b>2.3.2</b> Report (10%)</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="instructions.html"><a href="instructions.html#ujemi-submission"><i class="fa fa-check"></i><b>2.4</b> UJEMI submission</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="shell.html"><a href="shell.html"><i class="fa fa-check"></i><b>3</b> Running TreeSAPP on the Google Cloud Platform</a><ul>
<li class="chapter" data-level="3.1" data-path="shell.html"><a href="shell.html#resources-for-treesapp-analysis"><i class="fa fa-check"></i><b>3.1</b> Resources for TreeSAPP analysis</a></li>
<li class="chapter" data-level="3.2" data-path="shell.html"><a href="shell.html#checklist-to-write-and-run-shell-script"><i class="fa fa-check"></i><b>3.2</b> Checklist to write and run shell script</a></li>
<li class="chapter" data-level="3.3" data-path="shell.html"><a href="shell.html#shell-writing"><i class="fa fa-check"></i><b>3.3</b> Writing the shell script</a><ul>
<li class="chapter" data-level="3.3.1" data-path="shell.html"><a href="shell.html#defining-the-shell"><i class="fa fa-check"></i><b>3.3.1</b> Defining the shell</a></li>
<li class="chapter" data-level="3.3.2" data-path="shell.html"><a href="shell.html#setting-a-variable-for-your-depth"><i class="fa fa-check"></i><b>3.3.2</b> Setting a variable for your depth</a></li>
<li class="chapter" data-level="3.3.3" data-path="shell.html"><a href="shell.html#providing-user-feedback"><i class="fa fa-check"></i><b>3.3.3</b> Providing user feedback</a></li>
<li class="chapter" data-level="3.3.4" data-path="shell.html"><a href="shell.html#defining-variable-for-input-directory"><i class="fa fa-check"></i><b>3.3.4</b> Defining variable for input directory</a></li>
<li class="chapter" data-level="3.3.5" data-path="shell.html"><a href="shell.html#sharing-the-host-data-folder-with-the-singularity-container"><i class="fa fa-check"></i><b>3.3.5</b> Sharing the host data folder with the Singularity container</a></li>
<li class="chapter" data-level="3.3.6" data-path="shell.html"><a href="shell.html#creating-output-directory"><i class="fa fa-check"></i><b>3.3.6</b> Creating output directory</a></li>
<li class="chapter" data-level="3.3.7" data-path="shell.html"><a href="shell.html#reporting-variables-to-user"><i class="fa fa-check"></i><b>3.3.7</b> Reporting variables to user</a></li>
<li class="chapter" data-level="3.3.8" data-path="shell.html"><a href="shell.html#giving-path-to-singularity-container-with-treesapp"><i class="fa fa-check"></i><b>3.3.8</b> Giving path to Singularity container with TreeSAPP</a></li>
<li class="chapter" data-level="3.3.9" data-path="shell.html"><a href="shell.html#listing-treesapp-version"><i class="fa fa-check"></i><b>3.3.9</b> Listing TreeSAPP version</a></li>
<li class="chapter" data-level="3.3.10" data-path="shell.html"><a href="shell.html#executing-treesapp-analysis"><i class="fa fa-check"></i><b>3.3.10</b> Executing TreeSAPP analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="R.html"><a href="R.html"><i class="fa fa-check"></i><b>4</b> Analysing the TreeSAPP output in R</a><ul>
<li class="chapter" data-level="4.1" data-path="R.html"><a href="R.html#resources-for-analysis-of-treesapp-output-in-r"><i class="fa fa-check"></i><b>4.1</b> Resources for analysis of TreeSAPP output in R</a></li>
<li class="chapter" data-level="4.2" data-path="R.html"><a href="R.html#checklist-to-write-and-run-r-script"><i class="fa fa-check"></i><b>4.2</b> Checklist to write and run R script</a></li>
<li class="chapter" data-level="4.3" data-path="R.html"><a href="R.html#R-writing"><i class="fa fa-check"></i><b>4.3</b> Writing the R script</a></li>
<li class="chapter" data-level="4.4" data-path="R.html"><a href="R.html#load-any-required-packages"><i class="fa fa-check"></i><b>4.4</b> Load any required packages</a></li>
<li class="chapter" data-level="4.5" data-path="R.html"><a href="R.html#load-metagenomic-and-metatranscriptomic-treesapp-data"><i class="fa fa-check"></i><b>4.5</b> Load metagenomic and metatranscriptomic TreeSAPP data</a></li>
<li class="chapter" data-level="4.6" data-path="R.html"><a href="R.html#combine-the-metagenomic-and-metatranscriptomic-data"><i class="fa fa-check"></i><b>4.6</b> Combine the metagenomic and metatranscriptomic data</a></li>
<li class="chapter" data-level="4.7" data-path="R.html"><a href="R.html#subset-your-data-to-the-variables-and-marker-genes-of-interest."><i class="fa fa-check"></i><b>4.7</b> Subset your data to the variables and marker genes of interest.</a></li>
<li class="chapter" data-level="4.8" data-path="R.html"><a href="R.html#processing-taxonomic-information"><i class="fa fa-check"></i><b>4.8</b> Processing taxonomic information</a></li>
<li class="chapter" data-level="4.9" data-path="R.html"><a href="R.html#load-the-geochemical-data-set-into-a-new-data-frame."><i class="fa fa-check"></i><b>4.9</b> Load the geochemical data set into a new data frame.</a></li>
<li class="chapter" data-level="4.10" data-path="R.html"><a href="R.html#additional-hints-for-each-guiding-question"><i class="fa fa-check"></i><b>4.10</b> Additional Hints for each guiding question</a><ul>
<li class="chapter" data-level="4.10.1" data-path="R.html"><a href="R.html#how-does-abundance-of-denitrification-genes-differ-across-the-pathway-are-trends-similar-for-both-rna-and-dna"><i class="fa fa-check"></i><b>4.10.1</b> How does abundance of denitrification genes differ across the pathway? Are trends similar for both RNA and DNA?</a></li>
<li class="chapter" data-level="4.10.2" data-path="R.html"><a href="R.html#how-does-microbial-diversity-differ-across-the-pathway-are-trends-similar-for-both-rna-and-dna"><i class="fa fa-check"></i><b>4.10.2</b> How does microbial diversity differ across the pathway? Are trends similar for both RNA and DNA?</a></li>
<li class="chapter" data-level="4.10.3" data-path="R.html"><a href="R.html#what-specific-taxa-are-responsible-for-denitrification-are-they-the-same-for-all-steps-for-dna-versus-rna"><i class="fa fa-check"></i><b>4.10.3</b> What specific taxa are responsible for denitrification? Are they the same for all steps? For DNA versus RNA?</a></li>
<li class="chapter" data-level="4.10.4" data-path="R.html"><a href="R.html#how-does-the-abundance-of-denitrification-genes-relate-to-nitrogen-species-in-saanich-use-the-geochemical-data-in-saanich_data.csv-from-our-previous-data-science-sessions"><i class="fa fa-check"></i><b>4.10.4</b> How does the abundance of denitrification genes relate to nitrogen species in Saanich (use the geochemical data in <code>Saanich_Data.csv</code> from our previous data science sessions)?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i><b>5</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mapping microbes and marine denitrification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shell" class="section level1">
<h1><span class="header-section-number">3</span> Running TreeSAPP on the Google Cloud Platform</h1>
<p>These instructions will help you to complete the script template <code>treesapp_analysis.sh</code> to run your TreeSAPP analysis of the Saanich Inlet data of your assigned depth on the Google Cloud Platform (GCP) and copy the output files to your local machine. To adjust the code examples below and in the script template, replace any angle brackets, e.g. <code>&lt;SOME TEXT&gt;</code>, with the missing code.</p>
<div id="resources-for-treesapp-analysis" class="section level2">
<h2><span class="header-section-number">3.1</span> Resources for TreeSAPP analysis</h2>
<ul>
<li><p>A shell script template called <code>treesapp_analysis.sh</code> on Canvas.</p></li>
<li><p>A Google Cloud instance for your group called <code>group-&lt;your group number&gt;</code>.</p></li>
<li><p>The Saanich Inlet data located in the <code>/usr/local/data/MICB425/SI072_Data</code> directory of your Google Cloud instance, specifically:</p>
<ul>
<li>Metagenomic (metaG, DNA) reads: <code>/usr/local/data/MICB425/SI072_Data/MetaG_reads/</code></li>
<li>Metatranscriptomic (metaT, RNA): reads <code>/usr/local/data/MICB425/SI072_Data/MetaT_reads/</code></li>
<li>Assemblies of both DNA <strong>and</strong> RNA <code>/usr/local/data/MICB425/SI072_Data/MetaG_assemblies/</code></li>
</ul></li>
<li><p>A Singularity container with TreeSAPP on your Google Cloud instance at <code>/usr/local/bin/treesapp.sif</code>.</p></li>
</ul>
</div>
<div id="checklist-to-write-and-run-shell-script" class="section level2">
<h2><span class="header-section-number">3.2</span> Checklist to write and run shell script</h2>
<ul>
<li><p><input type="checkbox" disabled="" />
Edit the <code>treesapp_analysis.sh</code> script following <a href="shell.html#shell-writing">the instructions below</a>.</p></li>
<li><p><input type="checkbox" disabled="" />
Using the command line interface (CLI) on your computer, copy the script to your group’s Google Cloud instance using:<br />
<code>gcloud compute scp &lt;path to file on your computer&gt; &lt;group instance&gt;:&lt;destination&gt;</code></p></li>
<li><p><input type="checkbox" disabled="" />
Make the script executable on the Google Cloud instance (otherwise you won’t be able to run it). In the CLI and while in the directory containing your script, run the following command:<br />
<code>chmod u+x treesapp_analysis.sh</code>.</p></li>
<li><p><input type="checkbox" disabled="" />
Still in the CLI, start a new session with <code>screen -S &lt;session name&gt;</code>.</p></li>
<li><p><input type="checkbox" disabled="" />
In the new session, start the script with <code>./treesapp_analysis.sh</code>.</p></li>
<li><p><input type="checkbox" disabled="" />
After the script has run (will take at most 8 hours), locate the <code>final_output/marker_contig_map.tsv</code> files (one copy for the metagenomic and one for the metatranscriptomic analysis) in the TreeSAPP output directory and copy each one to your local computer:<br />
<code>gcloud compute scp &lt;group instance&gt;:&lt;path to file&gt; &lt;destination on your computer&gt;</code></p></li>
</ul>
<p>After these steps, you will continue with the analysis of your results in R on your local computer using R and the provided <code>treesapp_analysis.R</code> script template.</p>
</div>
<div id="shell-writing" class="section level2">
<h2><span class="header-section-number">3.3</span> Writing the shell script</h2>
<p>In the <code>treesapp_analysis.sh</code> script, we will define some variables to make our code more readable when running commands, give some feedback to the user as the script runs, and finally run the TreeSAPP workflow using a Singularity container. Edit the script either on your local computer or after you have copied it to the Google Cloud instance using the text editor of your choice (e.g. RStudio on your local machine or <code>nano &lt;file name&gt;</code> on GCP).</p>
<div id="defining-the-shell" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Defining the shell</h3>
<p>The script template starts with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="shell.html#cb1-1"></a><span class="co">#! bin/bash</span></span></code></pre></div>
<p>and defines the shell used to interpret this script and where the shell is located (i.e. the <code>bash</code> shell in the <code>/bin</code> directory). You do not need to modify anything about that step.</p>
</div>
<div id="setting-a-variable-for-your-depth" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Setting a variable for your depth</h3>
<p>Let’s define our first variable with the name “depth”. Replace <code>&lt;your depth&gt;</code> with the depth your group has been assigned to (e.g. <code>100</code>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="shell.html#cb2-1"></a><span class="va">depth=</span><span class="st">&quot;&lt;your  depth&gt;&quot;</span></span></code></pre></div>
</div>
<div id="providing-user-feedback" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Providing user feedback</h3>
<p>It is good practice to provide feedback to the user while a script is running by printing messages to the terminal. Let’s print a welcome message to the terminal using the <code>echo</code> command to informing the user what the script is going to do. This is a great opportunity to call the <code>depth</code> variable that we have just defined.</p>
<p><em>Hint</em>: Remember, to call a variable, you have to prepend its name with a <code>$</code>, e.g. if the variable’s name is <code>some_variable</code> then you call it with <code>$some_variable</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="shell.html#cb3-1"></a><span class="bu">echo</span> <span class="st">&quot;TreeSAPP analysis of Saanich Inlet Data at Depth &lt;call depth variable&gt; m&quot;</span></span></code></pre></div>
</div>
<div id="defining-variable-for-input-directory" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Defining variable for input directory</h3>
<p>Define a variable for path to the input data directory. Let’s call the variable <code>input_dir</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="shell.html#cb4-1"></a><span class="op">&lt;</span><span class="ex">variable_name</span><span class="op">&gt;</span>=<span class="st">&quot;&lt;path to data directory&gt;&quot;</span></span></code></pre></div>
</div>
<div id="sharing-the-host-data-folder-with-the-singularity-container" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Sharing the host data folder with the Singularity container</h3>
<p>The data we want to analyze with TreeSAPP is located on the host system (the Google Cloud instance), but TreeSAPP itself is on the Singularity container. In general, files on the host system are not available to a container, i.e. we would not be able to process the data files with TreeSAPP! Luckily, we can to make the host directory with our data available to the container by creating a so-called bind path. Bind paths are defined by the environmental variable <code>SINGULARITY_BIND</code> which we will <code>export</code> (so it is also available to Singularity). Your home directories on both host and container will automatically be connected (i.e. whatever you save in the home directory of the container will be also available in the home directory of the host).</p>
<p><em>Hint</em>: Remember that you already defined a variable containing the path to the input directory.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="shell.html#cb5-1"></a><span class="bu">export</span> <span class="op">&lt;</span><span class="bu">bind</span> paths variable name<span class="op">&gt;</span>=<span class="st">&quot;&lt;shared directory&gt;&quot;</span></span></code></pre></div>
</div>
<div id="creating-output-directory" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Creating output directory</h3>
<p>Define a variable for the TreeSAPP output directory and choose a name for it yourself. The directory should be located in your home directory (which is also shared between your host and container). To refer to your home directory, use the environmental variable <code>HOME</code> which is automatically defined by the shell (i.e. you do not need to first define it yourself). Finally, create the output directory.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="shell.html#cb6-1"></a><span class="op">&lt;</span><span class="kw">set</span> <span class="ex">output</span> directory variable<span class="op">&gt;</span></span>
<span id="cb6-2"><a href="shell.html#cb6-2"></a><span class="op">&lt;</span><span class="ex">create</span> the ouput directory<span class="op">&gt;</span></span></code></pre></div>
</div>
<div id="reporting-variables-to-user" class="section level3">
<h3><span class="header-section-number">3.3.7</span> Reporting variables to user</h3>
<p>Let’s provide the user some feedback where TreeSAPP is going to save its output and what bind paths have been set.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="shell.html#cb7-1"></a><span class="op">&lt;</span><span class="ex">print</span> command<span class="op">&gt;</span> <span class="st">&quot;&lt;Some text explaining what variables have been set&gt;&quot;</span></span></code></pre></div>
</div>
<div id="giving-path-to-singularity-container-with-treesapp" class="section level3">
<h3><span class="header-section-number">3.3.8</span> Giving path to Singularity container with TreeSAPP</h3>
<p>Let’s define a variable with the path to the Singularity TreeSAPP container.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="shell.html#cb8-1"></a><span class="op">&lt;</span><span class="ex">variable</span> for path to container<span class="op">&gt;</span></span></code></pre></div>
</div>
<div id="listing-treesapp-version" class="section level3">
<h3><span class="header-section-number">3.3.9</span> Listing TreeSAPP version</h3>
<p>In a previous tutorial we logged into the shell of the container (using <code>singularity shell &lt;container name&gt;</code>). One of the great advantages of containers is that we can directly execute commands on the container WITHOUT logging into it by using:<br />
<code>singularity exec &lt;container name&gt; &lt;command that can be incredibly long depending on what you are doing&gt;</code></p>
<p>Let’s print the information about the configuration of TreeSAPP using the command <code>treesapp info</code> on the container:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="shell.html#cb9-1"></a><span class="bu">echo</span> <span class="st">&quot;The Singularity container at &lt;path to container&gt; has the following \</span></span>
<span id="cb9-2"><a href="shell.html#cb9-2"></a><span class="st">configuration for TreeSAPP:&quot;</span></span>
<span id="cb9-3"><a href="shell.html#cb9-3"></a><span class="op">&lt;</span><span class="ex">execute</span> command on container<span class="op">&gt;</span> <span class="op">&lt;</span>path to container<span class="op">&gt;</span> treesapp info</span></code></pre></div>
<p><em>Hint</em>: When we have very long commands in a script, we can introduce line breaks using <code>\</code> which are best used right after a space in the command (see example above after the word “following”).</p>
</div>
<div id="executing-treesapp-analysis" class="section level3">
<h3><span class="header-section-number">3.3.10</span> Executing TreeSAPP analysis</h3>
<p>In CLI (i.e. not as part of this script), check the documentation for <code>treesapp assign</code>, the command you will use for the automated reconstruction of a nutrient cycle (visit its <a href="https://github.com/hallamlab/TreeSAPP/wiki/Classifying-sequences-with-treesapp-assign">wikipage</a> to learn more). Your command will look like this: <code>&lt;execute command on treesapp container&gt; treesapp assign -h</code>. Looking at the TreeSAPP documentation, determine the flags you need in addition to the ones already included below.</p>
<p>Time to run our analysis! You will have to identify the input file(s) that you need to process. Your group has been assigned a specific depth, and you do only need to process any files of that depth (indicated in the name, e.g. <code>SI072_135m_A_MetaT.fastq.gz</code> is the metatranscriptome at 135 m depth). You will run the analysis once for metagenomic (two files, forward reads are in the file that contains <code>.1</code> in its name, and reverse reads in file the with <code>.2</code>) and once for metatranscriptomic reads (a single file that contains both forward and reverse reads) and align them to the assembled contigs. All reads are pair-end.</p>
<p>You will need to provide the following settings using flags:</p>
<ul>
<li>Which assembly file to use.</li>
<li>To use 8 CPUs for the analysis.</li>
<li>To do the analysis for all marker genes provided in TreeSAPP.</li>
<li>To output a verbose runtime log.</li>
<li>Where to save the results.</li>
<li>To calculate the rpkm values for detected sequences.</li>
<li>Which reads to use and what type they are (i.e. pair-end or single-end).</li>
<li>To delete any intermediate files generated by the analysis.</li>
<li>To use position masking of multiple sequence alignment.</li>
</ul>
<p><em>Hints</em>:</p>
<ul>
<li>Will you ouput the data for metagenomic and metatranscriptomic analysis to the same folder? Does the folder already exist?</li>
<li>If you want the default value of a flag, then you do not need to provide it.</li>
<li>Where is the input data located in the singularity container?</li>
<li>Metatrascriptomic reads are <strong>NOT</strong> rRNA.</li>
<li>In scripts you often refer to variables while combined with additional text. Let’s say you have defined the variable <code>file_name="some_file"</code> to refer to the file <code>some_file</code>. Now you want to save a modified version of the file as <code>some_file_modified</code>. If you would write <code>$file_name_modified</code>, then the shell does not know that you just want to call a variable called <code>$file_name</code> and instead will assume you are calling a variable called <code>$file_name_modified</code> and will return an empty string. To indicate the beginning and end of a variable name, use curly braces. In the above example, you would use <code>${file_name}_modified</code>.</li>
</ul>
<p>Optional bonus challenge:<br />
Earlier we defined the <code>depth</code> variable. Could you use it in some way when you define which assembly and reads you are using in the analysis?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="shell.html#cb10-1"></a><span class="co"># Metagenomic analysis</span></span>
<span id="cb10-2"><a href="shell.html#cb10-2"></a><span class="ex">singularity</span> exec <span class="op">&lt;</span>treesapp container<span class="op">&gt;</span> \</span>
<span id="cb10-3"><a href="shell.html#cb10-3"></a>treesapp assign \</span>
<span id="cb10-4"><a href="shell.html#cb10-4"></a>-i <span class="op">&lt;</span>input data dir<span class="op">&gt;&lt;</span>file path to your assembly<span class="op">&gt;</span> \</span>
<span id="cb10-5"><a href="shell.html#cb10-5"></a>-m <span class="op">&lt;</span>choose the correct option<span class="op">&gt;</span> \</span>
<span id="cb10-6"><a href="shell.html#cb10-6"></a><span class="op">&lt;</span>number of CPU threads, set to <span class="op">8&gt;</span></span>
<span id="cb10-7"><a href="shell.html#cb10-7"></a><span class="op">&lt;</span><span class="ex">your</span> output directory<span class="op">&gt;</span> \</span>
<span id="cb10-8"><a href="shell.html#cb10-8"></a><span class="op">&lt;</span>your remaining settings<span class="op">&gt;</span></span>
<span id="cb10-9"><a href="shell.html#cb10-9"></a></span>
<span id="cb10-10"><a href="shell.html#cb10-10"></a><span class="co"># Metatranscriptomic analysis</span></span>
<span id="cb10-11"><a href="shell.html#cb10-11"></a><span class="op">&lt;</span><span class="ex">you</span> are on your own now :)<span class="op">&gt;</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="instructions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="R.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
